<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>IOC |  Fanfan</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <!-- mermaid -->
      
    <link rel="alternate" href="/atom.xml" title="Fanfan" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Spring/Spring IOC"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  IOC
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/09/10/Spring/Spring%20IOC/" class="article-date">
  <time datetime="2021-09-10T03:41:56.000Z" itemprop="datePublished">2021-09-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">3.3k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">13 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <p>[TOC]</p>
<h3 id="1-IOC是什么"><a href="#1-IOC是什么" class="headerlink" title="1. IOC是什么"></a>1. IOC是什么</h3><p>Inversion of control，控制反转，是一种设计思想。在Java开发中，IoC意味着将设计好的对象交由容器控制，而不是传统的在你的对象内部控制。从以下几个方面理解IoC:</p>
<ol>
<li><p>谁控制谁？ IoC容器控制对象</p>
</li>
<li><p>控制什么？控制了外部资源的获取（对象、文件）</p>
</li>
<li><p>为什么是反转？传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，即正转；这里的反转是指由容器帮我们查找及注入依赖对象，对象只是被动的接收依赖对象。</p>
</li>
<li><p>反转了什么？依赖对象的获取被反转了。</p>
</li>
</ol>
<h3 id="2-Spring中的IOC"><a href="#2-Spring中的IOC" class="headerlink" title="2. Spring中的IOC"></a>2. <em>Spring中的IOC</em></h3><p>IoC是Spring的核心。对于Spring来说，IoC就是Spring来负责控制对象的生命周期和对象间的关系。Spring倡导的开发方式是：所有的类在Spring容器中登记，告诉Spring你是什么，需要什么，然后Spring会在系统运行到适当的时候，把你需要的东西交给你。所有类的创建、销毁都是由Spring来控制，而不是引用它的对象。</p>
<p>​    IoC的重点是：在系统运行中，动态的向某个对象提供它所需要的其他对象。这是通过DI来实现的。而DI是通过反射实现的。</p>
<h3 id="3-DI-IOC"><a href="#3-DI-IOC" class="headerlink" title="3. DI IOC"></a>3. DI IOC</h3><p>dependency injection依赖注入。</p>
<p>IOC容器动态地将某个对象注入应用程序中，这个对象是应用程序依赖的对象。</p>
<p>由IOC容器动态的将某个依赖关系注入到组件之中。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。从以下几个方面理解DI：</p>
<ol>
<li><p>谁依赖谁？应用程序依赖IoC容器</p>
</li>
<li><p>为什么需要依赖？应用程序需要IoC容器提供对象需要的外部资源</p>
</li>
<li><p>谁注入谁？IoC容器注入应用程序某个对象，即应用程序依赖的对象</p>
</li>
<li><p>注入了什么？注入了应用程序需要的外部资源（对象、资源、常量数据）</p>
</li>
</ol>
<p>DI和IoC的关系：是对同一个概念不同角度的描述。由于控制反转概念比较含糊，之后又提出了新的名字：“依赖注入”，相对IoC 而言，“依赖注入”明确描述了“被注入对象依赖IoC容器配置依赖对象”。</p>
<p>IoC描述了容器控制对象这一层面，DI描述了被注入对象依赖IoC容器配置依赖对象。</p>
<h3 id="4-IOC作用"><a href="#4-IOC作用" class="headerlink" title="4. IOC作用"></a>4. IOC作用</h3><p>好处：解耦，便于测试，利于功能复用，整个体系结构灵活</p>
<p>IoC对于编程从思想上，发生了主从换位的变化，应用程序原本是最大的，即要获取什么资源都是应用程序主动去获取的，但是在IoC的思想中，应用程序变成了被动，被动的等待IoC容器注入它需要的资源。</p>
<h3 id="5-Spring-IoC的循环依赖问题"><a href="#5-Spring-IoC的循环依赖问题" class="headerlink" title="5. Spring IoC的循环依赖问题"></a>5. Spring IoC的循环依赖问题</h3><h4 id="是什么："><a href="#是什么：" class="headerlink" title="是什么："></a><em>是什么：</em></h4><p>循环依赖其实是循环引用，也就是两个或则两个以上的 bean 互相持有对方，最终形成闭环。比如A依赖于B，B依赖于C，C又依赖于A。</p>
<h4 id="产生循环依赖的三种场景："><a href="#产生循环依赖的三种场景：" class="headerlink" title="产生循环依赖的三种场景："></a>产生循环依赖的三种场景：</h4><ol>
<li><p>构造器的循环依赖：项目启动时报错some of beans in the application context form a circle</p>
</li>
<li><p>field 属性的循环依赖prototype：同上</p>
</li>
<li><p>field 属性的循环依赖：项目启动成功，尽管有循环依赖，但bean 可以被成功初始化</p>
</li>
</ol>
<h4 id="单例bean如何解决循环依赖问题："><a href="#单例bean如何解决循环依赖问题：" class="headerlink" title="单例bean如何解决循环依赖问题："></a>单例bean如何解决循环依赖问题：</h4><p>解决办法：<em><strong>三级缓存</strong></em></p>
<p>具体来说：</p>
<p>假设A中注入属性B，B中注入属性A：</p>
<ol>
<li><p>初始化A：A第一次初始化缓存中没有，使用反射初始化，此时并不会触发B的初始化</p>
</li>
<li><p>将初始化完成，但尚未填充属性的A加入三级缓存</p>
</li>
<li><p>开始A的属性填充，获取B的bean，触发B的初始化</p>
</li>
<li><p>初始化B：B第一次初始化缓存中没有，使用反射初始化</p>
</li>
<li><p>将初始化完成，但尚未填充属性的B加入三级缓存</p>
</li>
<li><p>开始B的属性填充，获取A的bean</p>
</li>
<li><p>A属于第二次初始化，直接从三级缓存中拿到之前存储的值，直接返回</p>
</li>
</ol>
<h4 id="为什么构造器无法解决循环依赖问题"><a href="#为什么构造器无法解决循环依赖问题" class="headerlink" title="为什么构造器无法解决循环依赖问题"></a>为什么构造器无法解决循环依赖问题</h4><p>单例的bean：反射初始化bean-写入三级缓存-填充属性</p>
<p>Prototype、构造器：在写入缓存之前执行构造方法，进行初始化，导致并没有存入三级缓存，发生死循环，spring抛出异常。</p>
<h4 id="为什么prototype无法解决"><a href="#为什么prototype无法解决" class="headerlink" title="为什么prototype无法解决"></a>为什么prototype无法解决</h4><p>prototypeBean会在创建之前将正在创建的Bean Name放入一个Set中，在循环依赖时检查beanName是否处于创建状态。</p>
<h4 id="如何检查循环依赖的"><a href="#如何检查循环依赖的" class="headerlink" title="如何检查循环依赖的"></a>如何检查循环依赖的</h4><p>根据Bean的状态给Bean进行mark，无论是构造注入还是属性值注入，第二次进入初始化同一个bean时（即调用getBean(A)方法时），如果发现bean当时正在创建中，那么抛出循环依赖的异常即可。</p>
<h4 id="三级缓存是什么？"><a href="#三级缓存是什么？" class="headerlink" title="三级缓存是什么？"></a><em>三级缓存是什么？</em></h4><p>一级缓存Map&lt;String, Object&gt; singletonObjects：保存所有的singletonBean的实例</p>
<p>二级缓存Map&lt;String, Object&gt; earlySingletonObjects：保存所有早期创建的Bean对象，这个Bean还没有完成依赖注入 </p>
<p>三级缓存Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories： singletonBean的生产工厂</p>
<p>Set<String> registeredSingletons：保存所有已经完成初始化的Bean的名字</String></p>
<p>Set<String> singletonsCurrentlyInCreation：标识指定name的Bean对象是否处于创建状态  </String></p>
<h4 id="Bean依赖注入的过程："><a href="#Bean依赖注入的过程：" class="headerlink" title="Bean依赖注入的过程："></a><em>Bean依赖注入的过程：</em></h4><ol>
<li><p>Bean实例化，即调用对象的构造方法进行实例化，使用反射和cglib</p>
</li>
<li><p>填充属性，设置bean对象的依赖关系，对依赖对象进行填充</p>
</li>
</ol>
<p>具体报错如下：</p>
<ol>
<li><p>构造器的循环依赖</p>
<p>代码：</p>
<p>@Service</p>
<p>public class A {</p>
<p>  public A(B b) {  }</p>
<p>}</p>
<p>@Service</p>
<p>public class B {</p>
<p>  public B(C c) {</p>
<p>  }</p>
<p>}</p>
<p>@Service</p>
<p>public class C {</p>
<p>  public C(A a) {  }</p>
<p>}</p>
<p>报错：some of beans in the application context form a circle.</p>
<p><img src="/2021/09/10/Spring/Spring%20IOC/IOC/wps12.png" alt="img"> </p>
</li>
<li><p>Field属性的循环依赖</p>
<p>代码：</p>
<p>@Service</p>
<p>public class A1 {</p>
<p>  @Autowired</p>
<p>  private B1 b1;</p>
<p>}</p>
<p>@Service</p>
<p>public class B1 {</p>
<p>  @Autowired</p>
<p>  public C1 c1;</p>
<p>}</p>
<p>@Service</p>
<p>public class C1 {</p>
<p>  @Autowired  public A1 a1;</p>
<p>}</p>
<p>结果：项目启动成功</p>
</li>
<li><p>Field属性注入循环依赖prototype</p>
<p>代码：</p>
<p>@Service</p>
<p>@Scope(“prototype”)</p>
<p>public class A1 {</p>
<p>  @Autowired</p>
<p>  private B1 b1;</p>
<p>}</p>
<p>@Service</p>
<p>@Scope(“prototype”)</p>
<p>public class B1 {</p>
<p>  @Autowired</p>
<p>  public C1 c1;</p>
<p>}</p>
<p>@Service</p>
<p>@Scope(“prototype”)</p>
<p>public class C1 {</p>
<p>  @Autowired  public A1 a1;</p>
<p>}</p>
<p>结果：项目启动失败，发现了一个cycle。同第一种。</p>
</li>
</ol>
<p>总结：构造器注入和prototype类型的属性注入都会初始化Bean失败，但单例的属性注入是可以成功的。</p>
<h3 id="6-bean-依赖注入方式（xml）"><a href="#6-bean-依赖注入方式（xml）" class="headerlink" title="6. bean 依赖注入方式（xml）"></a>6. bean 依赖注入方式（xml）</h3><p>在Spring中，共有四种方式为bean的属性注入值，分别是：</p>
<p>构造器、 set方法、静态工厂、实例工厂</p>
<h4 id="构造器注入："><a href="#构造器注入：" class="headerlink" title="构造器注入："></a><em>构造器注入：</em></h4><p>通过<strong>constructor-arg标签</strong>为构造器传入参数值</p>
<p>public class Car {</p>
<p>  String name;</p>
<p>  String brand;</p>
<p>  public void setName(String name) {</p>
<p>​    this.name = name;</p>
<p>  }</p>
<p>  public void setBrand(String brand) {</p>
<p>​    this.brand = brand;</p>
<p>  }</p>
<p>  public Car() {</p>
<p>  }</p>
<p>  public Car(String name, String brand) {</p>
<p>​    this.name = name;</p>
<p>​    this.brand = brand;</p>
<p>  }</p>
<p>  public void drive() {</p>
<p>​    System.out.println(brand + “ “ + name + “ is running”);</p>
<p>  }</p>
<p>}   </p>
<p>定义bean.xml文件：</p>
<bean id="car" class="com.juliajiang.aopdemo.bean.Car">

<p>​    <constructor-arg name="brand" value="BMW"></constructor-arg></p>
<p>​    <constructor-arg name="name" value="Jack"></constructor-arg></p>
  </bean>

<p>测试：</p>
<p>  @Test</p>
<p>  void testCar() {</p>
<p>​    ApplicationContext context = new ClassPathXmlApplicationContext(“bean.xml”);</p>
<p>​    Car car = (Car)context.getBean(“car”);</p>
<p>​    car.drive();</p>
<p>  }</p>
<p>输出：</p>
<p>BMW Jack is running</p>
<h4 id="set方法注入："><a href="#set方法注入：" class="headerlink" title="set方法注入："></a>set方法注入：</h4><p>Spring容器就是通过调用<strong>bean的set方法为属性注入值</strong>的。而在xml文件中，使用set注入的方式就是通过<strong>property标签</strong>。</p>
  <bean id="car2" class="com.juliajiang.aopdemo.bean.Car">

<p>​    <property name="brand" value="aodi"></property></p>
<p>​    <property name="name" value="julia"></property></p>
  </bean>

<p>  @Test</p>
<p>  void testCar2() {</p>
<p>​    ApplicationContext context = new ClassPathXmlApplicationContext(“bean.xml”);</p>
<p>​    Car car = (Car)context.getBean(“car2”);</p>
<p>​    car.drive();</p>
<p>  }</p>
<p>输出：</p>
<p>aodi julia is running</p>
<h4 id="静态工厂注入"><a href="#静态工厂注入" class="headerlink" title="静态工厂注入"></a><em>静态工厂注入</em></h4><p>编写一个静态的工厂方法，这个工厂方法会返回一个我们需要的值，然后在配置文件中，我们指定使用这个工厂方法（<strong>factory-method标签</strong>）创建bean</p>
<p>public class CarFactory {</p>
<p>  public static Car staticCreateCar(){</p>
<p>​    return new Car(“benchi”, “jennie”);</p>
<p>  }</p>
<p>}</p>
  <bean id="car3" class="com.juliajiang.aopdemo.bean.CarFactory" factory-method="staticCreateCar">

  </bean>

<p>  @Test</p>
<p>  void testCar3() {</p>
<p>​    ApplicationContext context = new ClassPathXmlApplicationContext(“bean.xml”);</p>
<p>​    Car car = (Car)context.getBean(“car3”);</p>
<p>​    car.drive();</p>
<p>  }</p>
<h4 id="实例工厂注入"><a href="#实例工厂注入" class="headerlink" title="实例工厂注入"></a><strong><strong>实例工厂注入</strong></strong></h4><p><strong>需要有一个实例对象</strong>，才能调用它的工厂方法</p>
<p>public class CarFactory {</p>
<p>  public Car createCar(){</p>
<p>​    return new Car(“benchi”, “jennie”);</p>
<p>  }</p>
<p>}</p>
<p>  <bean id="carFactory" class="com.juliajiang.aopdemo.bean.CarFactory"></bean></p>
<p>  <bean id="car4" factory-bean="carFactory" factory-method="createCar"></bean></p>
<p>  @Test</p>
<p>  void testCar4() {</p>
<p>​    ApplicationContext context = new ClassPathXmlApplicationContext(“bean.xml”);</p>
<p>​    Car car = (Car)context.getBean(“car4”);</p>
<p>​    car.drive();</p>
<p>  }</p>
<h3 id="7-bean-依赖注入方式（Java-Config）"><a href="#7-bean-依赖注入方式（Java-Config）" class="headerlink" title="7. bean 依赖注入方式（Java Config）"></a>7. bean 依赖注入方式（Java Config）</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/52b988e02c37">https://www.jianshu.com/p/52b988e02c37</a></p>
<p>通过Java Config创建bean有以下几种方式：</p>
<ol>
<li><p>构造器</p>
</li>
<li><p>静态工厂</p>
</li>
<li><p>实例工厂</p>
</li>
<li><p>通过FactoryBean创建</p>
</li>
</ol>
<p>Spring自动扫描组件：</p>
<p><em><strong>@Configuration</strong></em> </p>
<p>//标注了该注解的类是一个Spring的配置类,等价于原先的applicationContext.xml</p>
<p><em><strong>@ComponentScan</strong></em> </p>
<p>//开启Spring的注解自动扫描 , 默认情况下,扫描当前类所在包及其子包</p>
<p>public class Config {</p>
<p>}public static void main(String[] args) {</p>
<p>  ApplicationContext context </p>
<p>= new ClassPathXmlApplicationContext(“applicationContext.xml”);</p>
<p>  OneBean bean = context.getBean(“oneBean”,OneBean.class);</p>
<p>  System.out.println(bean);</p>
<p>}</p>
<p>public static void main(String[] args) {</p>
<p>  ApplicationContext context = new AnnotationConfigApplicationContext(Config.class);</p>
<p>  OneBean oneBean = context.getBean(OneBean.class);</p>
<p>  System.out.println(oneBean);</p>
<p>}</p>
<p><em><strong>构造器创建bean</strong></em></p>
<p>@Configuration</p>
<p>public class Config {</p>
<p>  <em><strong>@Bean</strong></em></p>
<p>  public OneBean oneBean() {</p>
<p>​    // 显然,这个Bean的CLass 是OneBean.class</p>
<p>​    // 在spring 中,bean的 id 是不能重复的,而现在使用java config来代替xml配置</p>
<p>​    // 在java config 方法名就是这个bean的id</p>
<p>​    return new OneBean();</p>
<p>  }</p>
<p>}</p>
<p><em><strong>静态工厂</strong></em></p>
<p>public class OneBeanFactory {</p>
<p>  public static OneBean getOneBean() {</p>
<p>​    return new OneBean();</p>
<p>  }</p>
<p>}</p>
<p>@Configuration</p>
<p>public class Config {</p>
<p>  <em><strong>@Bean</strong></em></p>
<p>  public OneBean oneBean1() {</p>
<p>​    return <em><strong>*OneBeanFactory.getOneBean();*</strong></em></p>
<p>  }</p>
<p>}</p>
<p><em><strong>实例工厂</strong></em></p>
<p>public class OneBeanFactory {</p>
<p>  public OneBean getOneBean() {</p>
<p>​    return new OneBean();</p>
<p>  }</p>
<p>}</p>
<p>@Configuration</p>
<p>public class Config {</p>
<p>  <em><strong>@Bean</strong></em></p>
<p>  public OneBean oneBean2() {</p>
<p>​    return <em><strong>*new OneBeanFactory().getOneBean();*</strong></em></p>
<p>  }</p>
<p>}</p>
<p><em><strong>通过</strong>***</em>FactoryBean***<em><strong>创建</strong></em></p>
<p>public class OneBeanFactory implements <em><strong>*FactoryBean<OneBean>*</OneBean></strong></em> {</p>
<p>  @Override</p>
<p>  public OneBean getObject() throws Exception {</p>
<p>​    return new OneBean();</p>
<p>  }</p>
<p>  @Override</p>
<p>  public Class&lt;?&gt; getObjectType() {</p>
<p>​    return OneBean.class;</p>
<p>  }</p>
<p>  @Override</p>
<p>  public boolean isSingleton() {</p>
<p>​    return true;</p>
<p>  }</p>
<p>}</p>
<p>@Configuration</p>
<p>public class Config {</p>
<p>  /**</p>
<p>   * OneBeanFactory 类实现了 Spring的 FactoryBean 接口,</p>
<p>   * Spring 知道这个类是用来创建 OneBean 对象的,</p>
<p>   * <em><strong>*方法虽然返回了 OneBeanFactory , 但是Spring 会帮我们用这个类来创建 OneBean*</strong></em></p>
<p>   */</p>
<p>  <em><strong>*@Bean*</strong></em></p>
<p>  public OneBeanFactory oneBean() {</p>
<p>​    return <em><strong>*new OneBeanFactory();*</strong></em></p>
<p>  }</p>
<p>  public static void main(String[] args) {</p>
<p>​    ApplicationContext context = new AnnotationConfigApplicationContext(Config.class);</p>
<p>​    OneBean oneBean = context.getBean(“oneBean”, OneBean.class);</p>
<p>​    System.out.println(oneBean);</p>
<p>​    // 通过 “&amp;”的方式获取对应的Factory</p>
<p>​    OneBeanFactory oneBeanFactory </p>
<p>= context.getBean(“<em><strong>*&amp;oneBean*</strong></em>“, OneBeanFactory.class);</p>
<p>​    System.out.println(oneBeanFactory);</p>
<p>  }</p>
<p>}</p>
<h3 id="8-bean的作用域"><a href="#8-bean的作用域" class="headerlink" title="8. bean的作用域"></a>8. bean的作用域</h3><ol>
<li><p>singleton : 唯一 bean 实例，Spring 中的 bean 默认都是单例的</p>
</li>
<li><p>prototype : 每次请求都会创建一个新的 bean 实例</p>
</li>
<li><p>request : 每一次HTTP请求都会产生一个新的bean，该bean仅在当前HTTP request内有效</p>
</li>
<li><p>session : 每一次HTTP请求都会产生一个新的 bean，该bean仅在当前 HTTP session 内有效</p>
</li>
<li><p>global-session： 全局session作用域，仅仅在基于portlet的web应用中才有意义，Spring5已经没有了。Portlet是能够生成语义代码(例如：HTML)片段的小型Java Web插件。它们基于portlet容器，可以像servlet一样处理HTTP请求。但是，与 servlet 不同，每个 portlet 都有不同的会话</p>
</li>
</ol>
<h3 id="9-单例-Bean的线程安全问题"><a href="#9-单例-Bean的线程安全问题" class="headerlink" title="9. 单例 Bean的线程安全问题"></a>9. 单例 Bean的线程安全问题</h3><p>的确是存在安全问题的。因为，当多个线程操作同一个对象的时候，对这个对象的成员变量的写操作会存在线程安全问题。</p>
<p>但是，一般情况下，我们常用的 Controller、Service、Dao 这些 Bean 是无状态的。无状态的 Bean 不能保存数据，因此是线程安全的。</p>
<p><strong>常见的有 2 种解决办法：</strong></p>
<ol>
<li><p>在类中定义一个 <strong>ThreadLocal</strong> 成员变量，将需要的可变成员变量保存在 ThreadLocal 中（推荐的一种方式）</p>
</li>
<li><p>改变 Bean 的作用域为 “<strong>prototype</strong>”：每次请求都会创建一个新的 bean 实例，自然不会存在线程安全问题。</p>
</li>
</ol>
<h3 id="10-Component-Bean"><a href="#10-Component-Bean" class="headerlink" title="10. @Component  @Bean"></a>10. @Component  @Bean</h3><ol>
<li><p>作用对象不同: @Component 注解作用于类，而@Bean注解作用于方法</p>
</li>
<li><p>作用不同：</p>
</li>
<li><p>@Component通常是通过类路径扫描来自动侦测以及自动装配到Spring容器中（我们可以使用 @ComponentScan 注解定义要扫描的路径从中找出标识了需要装配的类自动装配到 Spring 的 bean 容器中）。</p>
</li>
<li><p>@Bean 注解通常是我们在标有该注解的方法中定义产生这个 bean,@Bean告诉了Spring这是某个类的实例，当我需要用它的时候还给我</p>
</li>
<li><p>@Bean 注解比 Component 注解的自定义性更强，而且很多地方我们只能通过 @Bean 注解来注册bean。比如当我们引用第三方库中的类需要装配到 Spring容器时，则只能通过 @Bean来实现。</p>
</li>
</ol>
<h3 id="11-注入的接口有多个实现类"><a href="#11-注入的接口有多个实现类" class="headerlink" title="11. 注入的接口有多个实现类"></a>11. 注入的接口有多个实现类</h3><p>在TestController中注入接口testRepository：</p>
<p>@Controller</p>
<p>public class TestController {</p>
<p>  @Autowired</p>
<p>  TestRepository testRepository;</p>
<p>}</p>
<p>但接口testRepository有两个实现类：TestRepositoryImpl1 TestRepositoryImpl2</p>
<p>启动项目时会报错：</p>
<p>Field testRepository in com.juliajiang.aopdemo.employee.controller.TestController required a single bean, but 2 were found:</p>
<p>​    - testRepositoryImp2: defined in file [E:… repository\impl\TestRepositoryImp2.class]</p>
<p>​    - testRepositoryImpl1: defined in file [E:… repository\impl\TestRepositoryImpl1.class]</p>
<p><strong>@Autowired 的注入方式是 byType</strong> 注入， 当要注入的类型在容器中存在多个时，Spring是不知道要引入哪个实现类的，所以会报错。</p>
<p>这种场景下，只能通过 <strong>byName 注入</strong>的方式：</p>
<ol>
<li><p><strong>@Resource 默认是按照 byName</strong> 的方式注入的， 如果通过 byName 的方式匹配不到，再按 byType 的方式去匹配。name参数指定@Service注解中标定的名字，如果不指定会将testRepository作为类名，这样会报错找不到。</p>
<p>@Controller</p>
<p>public class TestController {</p>
<p>  <em><strong>@Resource(name = “testRepositoryImpl1”)</strong></em></p>
<p>  TestRepository testRepository;</p>
<p>}</p>
</li>
<li><p><strong>@Qualifier和@Autowired</strong>配合使用</p>
<p>@Controller</p>
<p>public class TestController {</p>
<p>  @Autowired</p>
<p>  @Qualifier(“testRepositoryImp2”)</p>
<p>  TestRepository testRepository;</p>
<p>}</p>
</li>
</ol>
<p>摘自：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xdp-gacl/p/4249939.html">https://www.cnblogs.com/xdp-gacl/p/4249939.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/52b988e02c37">https://www.jianshu.com/p/52b988e02c37</a></p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2021/09/10/Spring/Spring%20IOC/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/09/10/Spring/Bean%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Bean相关接口
          
        </div>
      </a>
    
    
      <a href="/2021/09/10/Spring/Spring%E6%A1%86%E6%9E%B6/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Spring框架</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "",
    app_key: "",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021
        <i class="ri-heart-fill heart_icon"></i> fyr
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/my.jpg" alt="Fanfan"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/life">生活</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
  </div>
</body>

</html>